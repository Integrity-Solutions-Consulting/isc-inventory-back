<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CompanyServiceImpl.java
package com.isc.service.impl;

import org.springframework.stereotype.Service;
import lombok.RequiredArgsConstructor;

import java.time.LocalDateTime;
import java.util.List;
import java.util.stream.Collectors;
=======
package com.isc.api.service.impl;

import java.time.LocalDateTime;
import java.util.List;
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CompanyServiceImpl.java

import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;

<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CompanyServiceImpl.java
import com.isc.dto.request.CompanyRequestDTO;
import com.isc.dto.response.CompanyDetailResponseDTO;
import com.isc.dto.response.CompanyResponseDTO;
import com.isc.dto.response.MessageResponseDTO;
import com.isc.dtos.MetadataResponseDto;
import com.isc.dtos.ResponseDto;
import com.isc.entitys.CompanyEntity;
import com.isc.mapper.CompanyMapper;
import com.isc.repository.CompanyRepository;
import com.isc.service.CompanyService;
=======
import com.isc.api.dto.request.CompanyRequestDTO;
import com.isc.api.dto.response.CompanyDetailResponseDTO;
import com.isc.api.dto.response.CompanyResponseDTO;
import com.isc.api.dto.response.MessageResponseDTO;
import com.isc.dtos.MetadataResponseDto;
import com.isc.dtos.ResponseDto;
import com.isc.api.entitys.CompanyEntity;
import com.isc.api.repository.CompanyRepository;
import com.isc.api.service.CompanyService;
import com.isc.api.mapper.CompanyMapper;
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CompanyServiceImpl.java

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CompanyServiceImpl.java
public class CompanyServiceImpl implements CompanyService{
	private final CompanyRepository companyRepository;

	@Override
    public ResponseDto<List<CompanyDetailResponseDTO>> getAllDetails() {
        List<CompanyDetailResponseDTO> response = companyRepository.findAllByStatusTrue().stream()
                .map(CompanyMapper::toDetailDto)
                .collect(Collectors.toList());
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Empresas listadas correctamente");
        return new ResponseDto<>(response, metadata);
=======
public class CompanyServiceImpl implements CompanyService {

    private final CompanyRepository repository;
    private final CompanyMapper companyMapper;

    @Override
    public ResponseDto<List<CompanyDetailResponseDTO>> getAllDetails() {
        List<CompanyDetailResponseDTO> list = repository.findAll().stream()
            .map(companyMapper::toDetailDTO)
            .toList();
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Compañías listadas con detalles correctamente");
        return new ResponseDto<>(list, metadata);
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CompanyServiceImpl.java
    }

    @Override
    public ResponseDto<List<CompanyResponseDTO>> getSimpleList() {
<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CompanyServiceImpl.java
        List<CompanyResponseDTO> response = companyRepository.findAllByStatusTrue().stream()
                .map(CompanyMapper::toSimpleDto)
                .collect(Collectors.toList());
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Empresas listadas correctamente");
        return new ResponseDto<>(response, metadata);
=======
        List<CompanyResponseDTO> list = repository.findAll().stream()
            .map(companyMapper::toResponseDTO)
            .toList();
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Compañías listadas correctamente");
        return new ResponseDto<>(list,metadata);
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CompanyServiceImpl.java
    }

    @Override
    public ResponseDto<CompanyDetailResponseDTO> save(CompanyRequestDTO request) {
        CompanyEntity entity = new CompanyEntity();
        entity.setName(request.getName());
<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CompanyServiceImpl.java
        entity.setDescription(request.getDescription());
        entity.setCreationUser("system"); // Reemplazar con usuario real
        entity.setCreationIp("127.0.0.1"); // Reemplazar con IP real
        
        entity = companyRepository.save(entity);
        CompanyDetailResponseDTO response = CompanyMapper.toDetailDto(entity);
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.CREATED, "Empresa creada correctamente");
        return new ResponseDto<>(response, metadata);
=======
        entity.setTaxId(request.getTaxId());
        entity.setAddress(request.getAddress());
        entity.setPhone(request.getPhone());
        entity.setEmail(request.getEmail());
        entity.setCreationDate(LocalDateTime.now());
        CompanyEntity saved = repository.save(entity);
        
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Compañia creada correctamente");
        return new ResponseDto<>(companyMapper.toDetailDTO(saved), metadata);
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CompanyServiceImpl.java
    }

    @Override
    public ResponseDto<CompanyDetailResponseDTO> update(CompanyRequestDTO request, Integer id) {
<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CompanyServiceImpl.java
        CompanyEntity entity = companyRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Empresa no encontrada con ID: " + id));
        
        entity.setName(request.getName());
        entity.setDescription(request.getDescription());
        entity.setModificationDate(LocalDateTime.now());
        entity.setModificationUser("system"); // Reemplazar con usuario real
        entity.setModificationIp("127.0.0.1"); // Reemplazar con IP real
        
        entity = companyRepository.save(entity);
        CompanyDetailResponseDTO response = CompanyMapper.toDetailDto(entity);
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Empresa actualizada correctamente");
        return new ResponseDto<>(response, metadata);
    }

    @Override
    public ResponseDto<MessageResponseDTO> inactive(Integer id) {
        int rowsAffected = companyRepository.inactive(id);
        if (rowsAffected == 0) {
            throw new RuntimeException("No se pudo desactivar la empresa con ID: " + id);
        }
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Empresa desactivada correctamente");
        MessageResponseDTO message = new MessageResponseDTO("Empresa desactivada correctamente");
        return new ResponseDto<>(message, metadata);
=======
        CompanyEntity entity = repository.findById(id)
            .orElseThrow(() -> new RuntimeException("Compañía no encontrada"));
        entity.setName(request.getName());
        entity.setTaxId(request.getTaxId());
        entity.setAddress(request.getAddress());
        entity.setPhone(request.getPhone());
        entity.setEmail(request.getEmail());
        entity.setModificationDate(LocalDateTime.now());
        CompanyEntity updated = repository.save(entity);
        
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Compañia actualizada");
        return new ResponseDto<>(companyMapper.toDetailDTO(updated),metadata);
    }

    @Override
    public ResponseDto<MessageResponseDTO> inactive(Integer id) 
    {
    	int rowsAffected = repository.inactive(id);
		if(rowsAffected == 0) 
		{
			 throw new RuntimeException("No se pudo realizar la operacion en el id: " + id);
		}
		MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Compañia desactivada");
		MessageResponseDTO message = new MessageResponseDTO("Operacion exitosa");
		return new ResponseDto<>(message, metadata);
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CompanyServiceImpl.java
    }

    @Override
    public ResponseDto<MessageResponseDTO> active(Integer id) {
<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CompanyServiceImpl.java
        int rowsAffected = companyRepository.active(id);
        if (rowsAffected == 0) {
            throw new RuntimeException("No se pudo activar la empresa con ID: " + id);
        }
        MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Empresa activada correctamente");
        MessageResponseDTO message = new MessageResponseDTO("Empresa activada correctamente");
        return new ResponseDto<>(message, metadata);
    }
}
=======
    	int rowsAffected = repository.active(id);
		if(rowsAffected == 0) {
			 throw new RuntimeException("No se pudo realizar la operacion en el id: " + id);
		}
	    MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Compañia activada");
		MessageResponseDTO message = new MessageResponseDTO("Operacion exitosa");
		return new ResponseDto<>(message, metadata);
    }
}

>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CompanyServiceImpl.java
