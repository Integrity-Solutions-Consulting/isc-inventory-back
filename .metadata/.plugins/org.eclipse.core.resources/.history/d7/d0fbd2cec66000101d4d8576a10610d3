<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CustomerServiceImpl.java
package com.isc.service.impl;
=======
package com.isc.api.service.impl;
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CustomerServiceImpl.java

import java.time.LocalDateTime;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;
<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CustomerServiceImpl.java

import com.isc.dto.request.CustomerRequestDTO;
import com.isc.dto.response.CustomerDetailResponseDTO;
import com.isc.dto.response.CustomerResponseDTO;
import com.isc.dto.response.MessageResponseDTO;
import com.isc.dtos.MetadataResponseDto;
import com.isc.dtos.ResponseDto;
import com.isc.entitys.CustomerEntity;
import com.isc.mapper.CustomerMapper;
import com.isc.repository.CustomerRepository;
import com.isc.service.CustomerService;
=======
import org.springframework.transaction.annotation.Transactional;

import com.isc.api.dto.request.CustomerRequestDTO;
import com.isc.api.dto.response.CustomerDetailResponseDTO;
import com.isc.api.dto.response.CustomerResponseDTO;
import com.isc.api.dto.response.MessageResponseDTO;
import com.isc.dtos.MetadataResponseDto;
import com.isc.dtos.ResponseDto;
import com.isc.api.entitys.CustomerEntity;
import com.isc.api.mapper.CustomerMapper;
import com.isc.api.repository.CustomerRepository;
import com.isc.api.service.CustomerService;
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CustomerServiceImpl.java

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
<<<<<<< HEAD:api/src/main/java/com/isc/service/impl/CustomerServiceImpl.java
public class CustomerServiceImpl implements CustomerService{
	private final CustomerRepository customerRepository;

	@Override
	public ResponseDto<List<CustomerDetailResponseDTO>> getAllDetails() {
		List<CustomerDetailResponseDTO> response = customerRepository.findAll().stream().map(CustomerMapper::toDetailDto)
				.collect(Collectors.toList());
		MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Clientes listados correctamente");
		return new ResponseDto<>(response, metadata);
	}

	@Override
	public ResponseDto<List<CustomerResponseDTO>> getSimpleList() {
		List<CustomerResponseDTO> response = customerRepository.findAllByStatusTrue().stream().map(CustomerMapper::toSimpleDto)
				.collect(Collectors.toList());
		MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Clientes listados correctamente");
		return new ResponseDto<>(response, metadata);
	}

	@Override
	public ResponseDto<CustomerDetailResponseDTO> save(CustomerRequestDTO request) {
		CustomerEntity entity = new CustomerEntity();
		entity.setName(request.getName());
		entity.setAddress(request.getAddress());
		entity.setEmail(request.getEmail());
		entity.setPhone(request.getPhone());
		entity = customerRepository.save(entity);
		CustomerDetailResponseDTO response = CustomerMapper.toDetailDto(entity);
		MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Cliente guardado correctamente");
		return new ResponseDto<>(response, metadata);
	}

	@Override
	public ResponseDto<CustomerDetailResponseDTO> update(CustomerRequestDTO request, Integer id) {
		CustomerEntity entity = customerRepository.findById(id)
				.orElseThrow(() -> new RuntimeException("Cliente no encontrado"));
		entity.setName(request.getName());
		entity.setAddress(request.getAddress());
		entity.setEmail(request.getEmail());
		entity.setPhone(request.getPhone());
		entity.setModificationDate(LocalDateTime.now());
		entity = customerRepository.save(entity);
		CustomerDetailResponseDTO response = CustomerMapper.toDetailDto(entity);
		MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Cliente actualizado correctamente");
		return new ResponseDto<>(response, metadata);
	}

	@Override
	public ResponseDto<MessageResponseDTO> inactive(Integer id) {
		int rowsAffected =  customerRepository.inactive(id);
		if(rowsAffected == 0) {
			 throw new RuntimeException("No se pudo realizar la operacion en el id: " + id);
		}
	    MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Operacion exitosa");
		MessageResponseDTO message = new MessageResponseDTO("Operacion exitosa");
		return new ResponseDto<>(message, metadata);
	}

	@Override
	public ResponseDto<MessageResponseDTO> active(Integer id) {
		int rowsAffected =  customerRepository.active(id);
		if(rowsAffected == 0) {
			 throw new RuntimeException("No se pudo realizar la operacion en el id: " + id);
		}
	    MetadataResponseDto metadata = new MetadataResponseDto(HttpStatus.OK, "Operacion exitosa");
		MessageResponseDTO message = new MessageResponseDTO("Operacion exitosa");
		return new ResponseDto<>(message, metadata);
	}
	
	
=======
public class CustomerServiceImpl implements CustomerService {

    private final CustomerRepository customerRepository;

    @Override
    public ResponseDto<List<CustomerDetailResponseDTO>> getAllDetails() {
        List<CustomerDetailResponseDTO> list = customerRepository.findAll()
                .stream()
                .map(CustomerMapper::toDetailDTO)
                .collect(Collectors.toList());

        return new ResponseDto<>(list, new MetadataResponseDto(HttpStatus.OK, "Lista completa de clientes"));
    }

    @Override
    public ResponseDto<List<CustomerResponseDTO>> getSimpleList() {
        List<CustomerResponseDTO> list = customerRepository.findAllByStatusTrue()
                .stream()
                .map(CustomerMapper::toResponseDTO)
                .collect(Collectors.toList());

        return new ResponseDto<>(list, new MetadataResponseDto(HttpStatus.OK, "Lista simple de clientes activos"));
    }

    @Override
    @Transactional
    public ResponseDto<CustomerDetailResponseDTO> save(CustomerRequestDTO request) {
        CustomerEntity entity = CustomerMapper.toEntity(request);
        entity.setCreationDate(LocalDateTime.now());
        entity.setStatus(true);

        CustomerEntity saved = customerRepository.save(entity);
        return new ResponseDto<>(CustomerMapper.toDetailDTO(saved), new MetadataResponseDto(HttpStatus.CREATED, "Cliente creado"));
    }

    @Override
    @Transactional
    public ResponseDto<CustomerDetailResponseDTO> update(CustomerRequestDTO request, Integer id) {
        CustomerEntity entity = customerRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Cliente no encontrado con ID: " + id));

        CustomerMapper.updateEntityFromDTO(entity, request);
        entity.setModificationDate(LocalDateTime.now());

        CustomerEntity updated = customerRepository.save(entity);
        return new ResponseDto<>(CustomerMapper.toDetailDTO(updated), new MetadataResponseDto(HttpStatus.OK, "Cliente actualizado"));
    }

    @Override
    @Transactional
    public ResponseDto<MessageResponseDTO> inactive(Integer id) {
        int updated = customerRepository.inactive(id);
        if (updated == 0) {
            throw new RuntimeException("No se pudo desactivar el cliente con ID: " + id);
        }

        return new ResponseDto<>(new MessageResponseDTO("Cliente desactivado"), new MetadataResponseDto(HttpStatus.OK, "Operación exitosa"));
    }

    @Override
    @Transactional
    public ResponseDto<MessageResponseDTO> active(Integer id) {
        int updated = customerRepository.active(id);
        if (updated == 0) {
            throw new RuntimeException("No se pudo activar el cliente con ID: " + id);
        }

        return new ResponseDto<>(new MessageResponseDTO("Cliente activado"), new MetadataResponseDto(HttpStatus.OK, "Operación exitosa"));
    }
>>>>>>> 0f93e5da78987daf93e729d5c42a36786331c01f:api/src/main/java/com/isc/api/service/impl/CustomerServiceImpl.java
}
